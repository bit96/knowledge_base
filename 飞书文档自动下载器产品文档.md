# 飞书文档自动下载器 - 产品需求文档

## 1. 产品概述

### 1.1 产品描述
飞书文档自动下载器是一个基于Python的自动化脚本，用于批量下载飞书文档并记录下载信息。该工具通过Selenium WebDriver控制Chrome浏览器，实现文档的自动化下载操作。

### 1.2 目标用户
需要批量下载飞书文档的用户，特别是需要备份或迁移大量文档的场景。

### 1.3 使用场景
- 批量文档备份
- 文档迁移
- 定期文档归档

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 自动化下载
- **功能描述**：自动遍历文档列表，逐个进入文档详情页面并执行下载操作
- **操作流程**：
  1. 连接到用户当前已登录的Chrome会话
  2. 从文档列表页面开始
  3. 依次点击进入每个文档的详情页面
  4. 获取文档标题和URL
  5. 点击右上角三个点按钮 → 选择"下载为" → 根据文档类型自动选择格式
  6. 等待下载完成，记录下载信息

#### 2.1.2 数据记录
- **功能描述**：将每个下载文档的信息记录到CSV文件中
- **记录字段**：
  - 文档标题
  - 文档URL
  - 下载时间
- **文件位置**：与脚本同目录下的`download_log.csv`

#### 2.1.3 文件管理
- **下载目录**：`/Users/abc/PycharmProjects/knowledge_base/.venv/output`
- **文件命名**：保持原始下载文件名，不进行重命名
- **格式选择**：
  - 文档类型为文本文档：下载为Word格式
  - 文档类型为表格文档：下载为Excel格式
  - 其他类型：根据飞书默认格式下载

### 2.2 高级功能

#### 2.2.1 防反爬策略
- **下载间隔**：每次下载间隔10-30秒（10秒基础 + 0-20秒随机）
- **批次休息**：每下载100个文档后休息30分钟
- **用户代理**：使用真实Chrome浏览器会话，避免被识别为机器人

#### 2.2.2 错误处理与重试
- **重试机制**：下载失败时自动重试，最多3次，每次间隔1分钟
- **错误终止**：遇到无法处理的错误时终止整个流程并显示详细错误信息
- **错误类型**：
  - 页面加载失败
  - 下载按钮未找到
  - 文档类型无法识别
  - 网络连接问题

#### 2.2.3 断点续传
- **进度保存**：实时保存处理进度到本地文件
- **续传功能**：脚本重新启动时可从上次中断位置继续
- **状态文件**：`progress.json`记录当前处理状态

#### 2.2.4 日志与监控
- **进度显示**：实时显示下载进度和当前处理的文档
- **日志记录**：详细记录操作日志，包括成功和失败的操作
- **日志文件**：`download.log`
- **控制台输出**：显示实时进度信息

## 3. 技术规格

### 3.1 技术栈
- **编程语言**：Python 3.8+
- **Web自动化**：Selenium WebDriver
- **浏览器**：Google Chrome（用户当前会话）
- **数据处理**：pandas（CSV文件操作）
- **日志管理**：logging模块
- **时间控制**：time + random模块

### 3.2 依赖库
```
selenium==4.15.0
pandas==2.1.0
webdriver-manager==4.0.0
```

### 3.3 系统要求
- **操作系统**：macOS
- **浏览器**：Google Chrome（已安装并登录飞书）
- **Python版本**：3.8及以上
- **磁盘空间**：根据文档数量，建议预留充足存储空间

## 4. 用户交互流程

### 4.1 准备工作
1. 确保Chrome浏览器已登录飞书账号
2. 导航到需要下载的文档列表页面
3. 确保下载目录存在且有写入权限

### 4.2 启动流程
1. 运行脚本：`python feishu_downloader.py`
2. 脚本连接到当前Chrome会话
3. 确认当前页面为文档列表页面
4. 开始自动下载流程

### 4.3 监控流程
1. 观察控制台输出的进度信息
2. 查看日志文件了解详细执行情况
3. 必要时可通过Ctrl+C安全中断程序

### 4.4 异常处理
1. 程序遇到错误时会显示详细错误信息
2. 可根据错误提示进行相应处理
3. 修复问题后可重新启动程序继续下载

## 5. 性能指标

### 5.1 处理能力
- **文档数量**：支持几百个文档的批量处理
- **并发处理**：单线程顺序处理（避免触发反爬限制）
- **处理速度**：平均每个文档30-60秒（包含下载时间和等待间隔）

### 5.2 稳定性要求
- **错误恢复**：支持从中断点继续执行
- **长时间运行**：支持连续运行数小时完成大批量下载
- **资源占用**：合理控制内存和CPU使用

## 6. 安全和隐私

### 6.1 数据安全
- 不存储用户登录凭据
- 仅记录必要的文档信息（标题、URL、时间）
- 本地存储，不上传到外部服务器

### 6.2 访问权限
- 仅访问用户有权限查看和下载的文档
- 不突破飞书的权限控制机制
- 遵守飞书的服务条款和使用限制

## 7. 维护和支持

### 7.1 日志管理
- 自动生成详细的操作日志
- 支持日志级别配置
- 定期清理历史日志文件

### 7.2 错误诊断
- 提供详细的错误信息和堆栈跟踪
- 支持调试模式输出更多诊断信息
- 常见问题的解决方案文档

### 7.3 更新维护
- 适配飞书界面变更
- 性能优化和bug修复
- 功能扩展和改进

## 8. 限制和注意事项

### 8.1 使用限制
- 仅支持macOS系统
- 需要预先登录Chrome浏览器
- 受飞书平台的反爬虫策略影响
- 下载速度受网络条件限制

### 8.2 法律合规
- 仅用于合法的文档备份和管理
- 遵守飞书服务条款
- 不得用于未授权的数据获取

### 8.3 技术限制
- 依赖Chrome浏览器和Selenium稳定性
- 可能受飞书页面结构变更影响
- 需要定期更新以适配新版本飞书

---

**版本**：v1.0  
**创建日期**：2025-08-08  
**最后更新**：2025-08-08