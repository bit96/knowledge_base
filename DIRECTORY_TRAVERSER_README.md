# 飞书知识库目录遍历器

基于 `test_word_click_fix_fast3.py` 架构开发的智能目录遍历工具，用于自动遍历飞书知识库的左侧目录树，记录每个页面的URL和标题信息。

## 🌟 核心特性

- **🕒 严格访问控制**: 每次访问间隔2-5秒随机延迟，尊重服务器负载
- **🛡️ 权限检查机制**: 自动检测和跳过无权限访问的页面
- **🔍 智能目录识别**: 多策略识别左侧目录结构
- **📊 详细数据记录**: 支持CSV、JSON、TXT多格式输出
- **🔄 错误恢复机制**: 智能重试和容错处理
- **📝 完整日志系统**: 详细记录执行过程和问题诊断

## 📋 使用前准备

### 1. 启动Chrome调试模式
```bash
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --remote-debugging-port=9222
```

### 2. 登录飞书并导航到知识库
- 在Chrome中登录飞书账号
- 导航到需要遍历的知识库页面
- 确保左侧目录树可见

### 3. 检查环境
- Python 3.7+ 
- Selenium WebDriver
- Chrome浏览器

## 🚀 运行方式

### 基础运行
```bash
python3 directory_traverser.py
```

### 交互式启动
程序会显示详细的功能介绍和使用说明，按回车键开始执行。

## 📊 输出文件

程序会在 `/Users/abc/PycharmProjects/knowledge_base/output/` 目录下生成以下文件：

### 主要数据文件
- **`directory_traverse_log.csv`** - 主要结果数据
  - 包含序号、目录项名称、页面标题、URL、访问时间等
- **`traverse_summary.json`** - 完整统计摘要
  - 包含执行时间、成功率、统计数据等

### 日志文件
- **`traverser.log`** - 详细执行日志
- **`permission_denied_log.txt`** - 权限不足项目记录（如有）
- **`failed_items_log.txt`** - 访问失败项目记录（如有）

## ⚙️ 访问控制特性

### 严格的时间控制
- 每次访问间隔：**2-5秒随机延迟**
- 自动检测并跳过无权限页面
- 智能重试机制处理临时错误

### 权限尊重机制
- 自动检测登录状态和权限错误
- 跳过403、未授权等受限页面
- 记录权限问题供后续分析

## 📈 执行流程

1. **初始化**: 连接Chrome、设置输出目录、初始化日志
2. **目录发现**: 智能识别左侧目录树结构
3. **展开折叠项**: 自动展开折叠的目录节点
4. **逐项访问**: 按2-5秒间隔依次访问每个项目
5. **数据提取**: 记录URL、标题、访问时间等信息
6. **权限检查**: 自动跳过无权限访问的页面
7. **结果保存**: 生成多格式数据文件和统计报告

## 🔧 故障排除

### Chrome连接问题
```bash
# 检查Chrome是否在调试模式运行
lsof -i :9222

# 重新启动Chrome调试模式
pkill Chrome
/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --remote-debugging-port=9222
```

### 页面识别问题

#### "未找到任何目录项"错误
如果程序显示找不到目录项，会自动提供详细诊断：

```
⚠️ 检测到当前可能是文档详情页面，不是目录列表页面
💡 建议操作:
   1. 点击浏览器'返回'按钮或导航到知识库主页
   2. 确保当前页面显示的是目录/文件列表
   3. 左侧应该有完整的目录树结构
   4. 当前页面: [页面标题]
   5. 当前URL: [当前地址]

📋 页面诊断报告
==================================================
🔗 URL: [具体URL]
📄 页面标题: [页面标题]
🔗 页面总链接数: [数量]
🔍 左侧区域链接数: [数量]
📋 左侧区域发现的链接:
   1. [链接名称]
      位置: (x, y坐标)
      链接: [链接地址]
🎯 页面类型: [页面类型判断]
💡 解决方案: [具体建议]
```

#### 常见页面类型和解决方案

1. **文档详情页** (`?fromScene=spaceOverview`等参数)
   - 解决方案：导航回知识库主页或目录列表页面
   - 可以点击浏览器的返回按钮

2. **知识库主页但目录折叠**
   - 解决方案：检查左侧是否有展开按钮
   - 确保目录树完全展开

3. **权限不足页面**
   - 程序会自动跳过并记录
   - 检查登录状态和访问权限

### 权限相关问题
- 程序会自动跳过无权限页面
- 检查 `permission_denied_log.txt` 了解具体情况
- 权限问题会在诊断报告中详细显示

## 📊 统计报告示例

```
📊 遍历完成统计报告
============================================================
⏰ 开始时间: 2025-08-10 18:30:15
⏰ 结束时间: 2025-08-10 18:45:32
⏱️ 总耗时: 917.3 秒
📋 发现项目总数: 25
✅ 成功访问: 22
⚠️ 权限不足跳过: 2
❌ 访问失败: 1
⏳ 平均延迟: 3.2 秒
📈 成功率: 88.0%
```

## ⚠️ 重要提醒

1. **访问频率控制**: 程序严格遵循2-5秒访问间隔，请勿手动干预
2. **权限尊重**: 自动跳过无权限页面，不会强制访问受限内容
3. **中断安全**: 可随时按 Ctrl+C 安全中断，部分结果会自动保存
4. **数据完整性**: 所有访问记录都会实时保存到文件中

## 💡 使用技巧

- **大型目录**: 对于包含大量子目录的知识库，程序会自动展开并遍历
- **网络中断**: 程序有重试机制，短暂网络问题会自动恢复
- **结果分析**: 使用Excel等工具打开CSV文件进行数据分析
- **批量处理**: 可以针对不同的知识库分别执行遍历

---

**开发基础**: 基于 `test_word_click_fix_fast3.py` 的架构和Chrome连接方式
**适用场景**: 飞书知识库内容索引、数据统计、权限审计等